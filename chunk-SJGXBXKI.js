import{b as p}from"./chunk-7J7XJZ7Y.js";import{c as I}from"./chunk-O3TBEYO6.js";import{b as m,c as g}from"./chunk-2TSUYDBP.js";import{u}from"./chunk-6M6X6DMA.js";import{P as f,T as h,Y as c,ya as d}from"./chunk-OK7OUPQM.js";var a=class extends Error{};a.prototype.name="InvalidTokenError";function w(o){return decodeURIComponent(atob(o).replace(/(.)/g,(e,i)=>{let t=i.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function v(o){let e=o.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return w(e)}catch{return atob(e)}}function l(o,e){if(typeof o!="string")throw new a("Invalid token specified: must be a string");e||(e={});let i=e.header===!0?0:1,t=o.split(".")[i];if(typeof t!="string")throw new a(`Invalid token specified: missing part #${i+1}`);let r;try{r=v(t)}catch(s){throw new a(`Invalid token specified: invalid base64 for part #${i+1} (${s.message})`)}try{return JSON.parse(r)}catch(s){throw new a(`Invalid token specified: invalid json for part #${i+1} (${s.message})`)}}var k=(()=>{let e=class e{constructor(t){this.platformId=t,this.storage=u(this.platformId)?localStorage:null}getItem(t){return this.storage?this.storage.getItem(t):null}setItem(t,r){this.storage&&this.storage.setItem(t,r)}removeItem(t){this.storage&&this.storage.removeItem(t)}clear(){this.storage&&this.storage.clear()}};e.\u0275fac=function(r){return new(r||e)(c(d))},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();var U=(()=>{let e=class e{constructor(t,r,s){this.http=t,this.router=r,this.storage=s}getAuthToken(){return this.storage.getItem("accessToken")}isAuthenticated(){if(!this.getAuthToken())return!1;let t=Number(localStorage.getItem("expiration"));return Math.floor(Date.now()/1e3)<t}isIe(){return this.storage.getItem("is_ie")=="true"}storeAuthToken(t){let s=JSON.parse(JSON.stringify(l(t.access_token))).a,n="false";(s?.includes("ie")||s?.includes("IE"))&&(n="true"),this.storage.setItem("accessToken",t.access_token),this.storage.setItem("refreshToken",t.refresh_token),this.storage.setItem("is_ie",n),this.storage.setItem("expiration",l(t.access_token).exp.toString())}destroyAuthToken(){this.storage.removeItem("accessToken"),this.storage.removeItem("refreshToken"),this.storage.removeItem("is_ie"),this.storage.removeItem("expiration")}loginAndRedirect(t,r){let s=t??{email:"user@teste.com",password:"senha"};return this.http.post("/auth/login",s,{context:new m().set(p,!1)}).pipe(f(n=>{n?.status=="success"&&n.data&&(this.storeAuthToken(n.data),this.router.navigate([r]))}))}refreshToken(){let t={refresh_token:this.storage.getItem("refreshToken")};return this.http.post("/auth/refresh-token",t,{context:new m().set(p,!1)}).pipe(f(r=>{r?.status=="success"&&r.data&&this.storeAuthToken(r.data)}))}logoutAndRedirect(){this.destroyAuthToken(),this.router.navigate(["/demo"])}};e.\u0275fac=function(r){return new(r||e)(c(g),c(I),c(k))},e.\u0275prov=h({token:e,factory:e.\u0275fac,providedIn:"root"});let o=e;return o})();export{U as a};
